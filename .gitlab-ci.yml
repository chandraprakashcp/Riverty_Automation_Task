stages:
  - test

variables:
  DOTNET_CLI_TELEMETRY_OPTOUT: "1"

windows-api-tests:
  stage: test
  script:
    - echo "Building Docker image for API tests..."
    - docker build -t booking-api-tests .
    - echo "Running tests in Docker container..."
    - mkdir -p test-reports
    - docker run --rm -v "${PWD}/test-reports:/app/bin/Release/net6.0/TestReports" booking-api-tests
    - echo "Test execution completed"
  after_script:
    - echo "Checking test reports..."
    - powershell "if (Test-Path 'test-reports') { Get-ChildItem 'test-reports' } else { Write-Host 'No test reports found' }"
  artifacts:
    when: always
    paths:
      - test-reports/
    expire_in: 1 week
  tags:
    - api