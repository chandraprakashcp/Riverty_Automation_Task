stages:
  - test

variables:
  DOTNET_CLI_TELEMETRY_OPTOUT: "1"

before_script:
  - dotnet --version
  - dotnet restore

api-tests:
  stage: test
  script:
    - echo "Running Booking API Tests..."
    - dotnet build --no-restore
    - dotnet test --logger "console;verbosity=normal" --no-build --verbosity normal
    - echo "Test execution completed"
  after_script:
    - echo "Moving reports to root directory..."
    - if (Test-Path "bin/Debug/net6.0/TestReports") { Copy-Item -Path "bin/Debug/net6.0/TestReports/*" -Destination "." -Recurse -Force }
    - echo "Reports available in root folder"
  artifacts:
    when: always
    paths:
      - "*.html"
      - "bin/Debug/net6.0/TestReports/"
    expire_in: 1 week
  only:
    - main
  tags:
    - api